"use strict";function n(n){return n&&"object"==typeof n&&"default"in n?n.default:n}var t=require("apollo-server-lambda"),e=n(require("uuid/v4")),i=n(require("aws-sdk"));let r=new i.DynamoDB.DocumentClient;"dev"===process.env.STAGE&&(r=new i.DynamoDB.DocumentClient({region:"localhost",endpoint:`http://localhost:${process.env.DYNAMODB_PORT}`,accessKeyId:"DEFAULT_ACCESS_KEY",secretAccessKey:"DEFAULT_SECRET"}));let a=process.env.RECIPE_TABLE;const s=n=>new Promise((t,e)=>{n((n,i)=>{n?e(n):t(i)})}),o={Query:{recipe:async(n,{id:t})=>{var e,i;return null===(i=null===(e=await s(n=>{const e={TableName:a,KeyConditionExpression:"id = :recipeId",ExpressionAttributeValues:{":recipeId":t}};r.query(e,n)}))||void 0===e?void 0:e.Items)||void 0===i?void 0:i[0]},recipes:async()=>{var n;return null===(n=await s(n=>{const t={TableName:a};r.scan(t,n)}))||void 0===n?void 0:n.Items}},Mutation:{createRecipe:async(n,{recipe:t},i)=>{const o=Object.assign({id:e(),createdAt:(new Date).toISOString(),author:i.user.name},t);return await s(n=>{const t={TableName:a,Item:o};r.put(t,n)}),o}}},p=async({requestContext:{authorizer:n}})=>{if(n){const n={name:"Panayiotis"};if(n)return n}return null},g=new t.ApolloServer({typeDefs:"\n  input RecipeInput {\n    name: String!\n    image: String\n    preparationTime: Int\n    cookingTime: Int\n    portions: String\n    difficulty: String\n    ingredients: [IngredientInput]\n    items: [ItemInput]\n    steps: [StepInput]\n    notes: [String]\n  }\n\n  input IngredientInput {\n    qty: String!\n    name: String!\n    notes: String\n    link: String\n  }\n\n  input ItemInput {\n    qty: String!\n    name: String!\n    notes: String\n    link: String\n  }\n\n  input LinkInput {\n    heading: String\n    name: String!\n    from: Int!\n    timerId: String\n  }\n\n  input TagInput {\n    text: String!\n    color: String!\n  }\n\n  input ImageInput {\n    src: String\n    alt: String\n  }\n\n  input TimerInput {\n    id: String!\n    name: String!\n    minutes: Int!\n    seconds: Int!\n  }\n\n  input StepInput {\n    no: Int\n    type: StepType!\n    links: [LinkInput]\n    tag: TagInput\n    items: [ItemInput]\n    ingredients: [IngredientInput]\n    tasks: [TaskInput]\n    images: [ImageInput]\n    timer: TimerInput\n  }\n\n  input TaskInput {\n    name: String!\n    notes: [String]\n  }\n\n  type Recipe {\n    id: String\n    author: String\n    createdAt: String\n    name: String\n    image: String\n    preparationTime: Int\n    cookingTime: Int\n    portions: String\n    difficulty: String\n    notes: [String]\n    ingredients: [Ingredient]\n    items: [Item]\n    steps: [Step]\n  }\n\n  type Ingredient {\n    qty: String\n    name: String\n    notes: String\n    link: String\n  }\n\n  type Item {\n    qty: String\n    name: String\n    notes: String\n    link: String\n  }\n\n  enum StepType {\n    MISE_EN_PLACE\n    PREPARATION\n  }\n\n  type Step {\n    no: Int\n    type: StepType\n    links: [Link]\n    tag: Tag\n    items: [Item]\n    ingredients: [Ingredient]\n    tasks: [Task]\n    images: [Image]\n    timer: Timer\n    notes: [String]\n  }\n\n  type Task {\n    name: String!\n    notes: [String]\n  }\n\n  type Link {\n    heading: String\n    name: String!\n    from: String!\n    timerId: String\n  }\n\n  type Tag {\n    text: String!\n    color: String!\n  }\n\n  type Image {\n    src: String!\n    alt: String\n  }\n\n  type Timer {\n    id: String!\n    name: String!\n    minutes: Int!\n    seconds: Int!\n  }\n\n  type Query {\n    recipes: [Recipe!]!\n    recipe(id: String!): Recipe!\n  }\n\n  type Mutation {\n    createRecipe(recipe: RecipeInput!): Recipe!\n  }\n\n  type schema {\n    query: Query\n    mutation: Mutation\n  }\n",resolvers:o,formatError:n=>(console.log(n),n),formatResponse:n=>(console.log(n),n),context:async({event:n,context:t})=>({headers:n.headers,functionName:t.functionName,event:n,context:t,user:await p(n)}),playground:{endpoint:"prod"===process.env.STAGE?"/prod/graphql":"/dev/graphql"},tracing:!0});exports.graphqlHandler=g.createHandler({cors:{origin:"*"}});
